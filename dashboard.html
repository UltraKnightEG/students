<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة حضور الطلاب</title>
    
    <!-- Bootstrap 5 RTL -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- QuaggaJS for Barcode Scanning -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
    
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/css/dashboard.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-graduation-cap me-2"></i>
                نظام إدارة الحضور
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" data-section="dashboard">
                            <i class="fas fa-tachometer-alt me-1"></i>
                            لوحة التحكم
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="scanner">
                            <i class="fas fa-qrcode me-1"></i>
                            ماسح الحضور
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="students">
                            <i class="fas fa-users me-1"></i>
                            إدارة الطلاب
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="classes">
                            <i class="fas fa-chalkboard me-1"></i>
                            إدارة الفصول
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="sessions">
                            <i class="fas fa-calendar-alt me-1"></i>
                            الجلسات
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="reports">
                            <i class="fas fa-chart-bar me-1"></i>
                            التقارير
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="whatsapp">
                            <i class="fab fa-whatsapp me-1"></i>
                            الواتساب
                        </a>
                    </li>
                </ul>
                
                <div class="navbar-nav">
                    <div class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-bell me-1"></i>
                            الإشعارات
                            <span class="badge bg-danger" id="alertsCount">0</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" id="alertsDropdown">
                            <li><h6 class="dropdown-header">الإشعارات الحديثة</h6></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-muted" href="#">لا توجد إشعارات جديدة</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid mt-5 pt-3">
        <!-- Dashboard Section -->
        <div id="dashboard-section" class="content-section active">
            <div class="row mb-4">
                <div class="col-12">
                    <h2 class="page-title">
                        <i class="fas fa-tachometer-alt me-2"></i>
                        لوحة التحكم
                    </h2>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="row mb-4">
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="stats-card bg-primary">
                        <div class="stats-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stats-content">
                            <h3 id="totalStudents">0</h3>
                            <p>إجمالي الطلاب</p>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="stats-card bg-success">
                        <div class="stats-icon">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <div class="stats-content">
                            <h3 id="todayPresent">0</h3>
                            <p>الحاضرون اليوم</p>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="stats-card bg-warning">
                        <div class="stats-icon">
                            <i class="fas fa-user-times"></i>
                        </div>
                        <div class="stats-content">
                            <h3 id="todayAbsent">0</h3>
                            <p>الغائبون اليوم</p>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="stats-card bg-info">
                        <div class="stats-icon">
                            <i class="fas fa-chalkboard-teacher"></i>
                        </div>
                        <div class="stats-content">
                            <h3 id="activeSessions">0</h3>
                            <p>الجلسات النشطة</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="row mb-4">
                <div class="col-lg-8 mb-3">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-chart-line me-2"></i>
                                اتجاه الحضور (آخر 7 أيام)
                            </h5>
                        </div>
                        <div class="card-body">
                            <canvas id="attendanceTrendChart" height="100"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-4 mb-3">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-chart-pie me-2"></i>
                                توزيع الفصول
                            </h5>
                        </div>
                        <div class="card-body">
                            <canvas id="classDistributionChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity & Top Classes -->
            <div class="row">
                <div class="col-lg-6 mb-3">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-clock me-2"></i>
                                النشاط الحديث
                            </h5>
                        </div>
                        <div class="card-body">
                            <div id="recentActivity" class="activity-list">
                                <div class="text-center text-muted">
                                    <i class="fas fa-spinner fa-spin"></i>
                                    جاري التحميل...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-6 mb-3">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-trophy me-2"></i>
                                أفضل الفصول حضوراً
                            </h5>
                        </div>
                        <div class="card-body">
                            <div id="topClasses" class="top-classes-list">
                                <div class="text-center text-muted">
                                    <i class="fas fa-spinner fa-spin"></i>
                                    جاري التحميل...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Scanner Section -->
        <div id="scanner-section" class="content-section">
            <div class="row mb-4">
                <div class="col-12">
                    <h2 class="page-title">
                        <i class="fas fa-qrcode me-2"></i>
                        ماسح الحضور
                    </h2>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-8 mb-4">
                    <div class="card scanner-card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-camera me-2"></i>
                                ماسح الباركود
                            </h5>
                            <div class="session-selector">
                                <select id="activeSessionSelect" class="form-select">
                                    <option value="">اختر الجلسة النشطة</option>
                                </select>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="scanner-container">
                                <div id="scanner-placeholder" class="text-center p-5">
                                    <i class="fas fa-qrcode fa-3x text-muted mb-3"></i>
                                    <p class="text-muted">اختر جلسة نشطة لبدء المسح</p>
                                    <button id="startScannerBtn" class="btn btn-primary" disabled>
                                        <i class="fas fa-play me-2"></i>
                                        بدء المسح
                                    </button>
                                </div>
                                <div id="scanner" style="display: none;"></div>
                            </div>
                            
                            <div class="manual-input mt-3" style="display: none;">
                                <div class="input-group">
                                    <input type="text" id="manualBarcodeInput" class="form-control" 
                                           placeholder="أدخل الباركود يدوياً أو امسحه">
                                    <button class="btn btn-success" id="manualSubmitBtn">
                                        <i class="fas fa-check me-1"></i>
                                        تسجيل
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-4 mb-4">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-chart-bar me-2"></i>
                                إحصائيات الجلسة
                            </h5>
                        </div>
                        <div class="card-body">
                            <div id="sessionStats">
                                <div class="stat-item">
                                    <span class="stat-label">إجمالي الطلاب:</span>
                                    <span class="stat-value" id="sessionTotalStudents">0</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">الحاضرون:</span>
                                    <span class="stat-value text-success" id="sessionPresentCount">0</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">الغائبون:</span>
                                    <span class="stat-value text-danger" id="sessionAbsentCount">0</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">معدل الحضور:</span>
                                    <span class="stat-value text-info" id="sessionAttendanceRate">0%</span>
                                </div>
                            </div>
                            
                            <div class="mt-3">
                                <button id="endSessionBtn" class="btn btn-danger w-100" disabled>
                                    <i class="fas fa-stop me-2"></i>
                                    إنهاء الجلسة
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card mt-3">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-list me-2"></i>
                                قائمة الحضور المباشرة
                            </h5>
                        </div>
                        <div class="card-body">
                            <div id="liveAttendanceList" class="attendance-list">
                                <div class="text-center text-muted">
                                    <i class="fas fa-users"></i>
                                    <p class="mb-0">لا توجد بيانات حضور</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Students Section -->
        <div id="students-section" class="content-section">
            <div class="row mb-4">
                <div class="col-12">
                    <h2 class="page-title">
                        <i class="fas fa-users me-2"></i>
                        إدارة الطلاب
                    </h2>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-lg-6">
                    <div class="input-group">
                        <input type="text" id="studentsSearch" class="form-control" placeholder="البحث عن طالب...">
                        <button class="btn btn-outline-secondary" type="button">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
                <div class="col-lg-3">
                    <select id="studentsClassFilter" class="form-select">
                        <option value="">جميع الفصول</option>
                    </select>
                </div>
                <div class="col-lg-3">
                    <button class="btn btn-primary w-100" data-bs-toggle="modal" data-bs-target="#addStudentModal">
                        <i class="fas fa-plus me-2"></i>
                        إضافة طالب جديد
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover" id="studentsTable">
                            <thead>
                                <tr>
                                    <th>الاسم</th>
                                    <th>الباركود</th>
                                    <th>الفصل</th>
                                    <th>رقم ولي الأمر</th>
                                    <th>معدل الحضور</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="6" class="text-center">
                                        <i class="fas fa-spinner fa-spin"></i>
                                        جاري التحميل...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <nav aria-label="Students pagination">
                        <ul class="pagination justify-content-center" id="studentsPagination">
                        </ul>
                    </nav>
                </div>
            </div>
        </div>

        <!-- Classes Section -->
        <div id="classes-section" class="content-section">
            <div class="row mb-4">
                <div class="col-12">
                    <h2 class="page-title">
                        <i class="fas fa-chalkboard me-2"></i>
                        إدارة الفصول
                    </h2>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-lg-6">
                    <div class="input-group">
                        <input type="text" id="classesSearch" class="form-control" placeholder="البحث عن فصل...">
                        <button class="btn btn-outline-secondary" type="button">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
                <div class="col-lg-3">
                    <select id="classesGradeFilter" class="form-select">
                        <option value="">جميع المستويات</option>
                    </select>
                </div>
                <div class="col-lg-3">
                    <button class="btn btn-primary w-100" data-bs-toggle="modal" data-bs-target="#addClassModal">
                        <i class="fas fa-plus me-2"></i>
                        إضافة فصل جديد
                    </button>
                </div>
            </div>

            <div class="row" id="classesGrid">
                <div class="col-12 text-center">
                    <i class="fas fa-spinner fa-spin"></i>
                    جاري التحميل...
                </div>
            </div>
        </div>

        <!-- Sessions Section -->
        <div id="sessions-section" class="content-section">
            <div class="row mb-4">
                <div class="col-12">
                    <h2 class="page-title">
                        <i class="fas fa-calendar-alt me-2"></i>
                        إدارة الجلسات
                    </h2>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-lg-4">
                    <div class="input-group">
                        <input type="text" id="sessionsSearch" class="form-control" placeholder="البحث في الجلسات...">
                        <button class="btn btn-outline-secondary" type="button">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
                <div class="col-lg-2">
                    <select id="sessionsClassFilter" class="form-select">
                        <option value="">جميع الفصول</option>
                    </select>
                </div>
                <div class="col-lg-2">
                    <select id="sessionsStatusFilter" class="form-select">
                        <option value="">جميع الحالات</option>
                        <option value="active">نشطة</option>
                        <option value="completed">مكتملة</option>
                        <option value="cancelled">ملغية</option>
                    </select>
                </div>
                <div class="col-lg-2">
                    <input type="date" id="sessionsDateFilter" class="form-control">
                </div>
                <div class="col-lg-2">
                    <button class="btn btn-primary w-100" data-bs-toggle="modal" data-bs-target="#addSessionModal">
                        <i class="fas fa-plus me-2"></i>
                        جلسة جديدة
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover" id="sessionsTable">
                            <thead>
                                <tr>
                                    <th>المادة</th>
                                    <th>الفصل</th>
                                    <th>التاريخ</th>
                                    <th>الوقت</th>
                                    <th>الحالة</th>
                                    <th>الحضور</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="7" class="text-center">
                                        <i class="fas fa-spinner fa-spin"></i>
                                        جاري التحميل...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <nav aria-label="Sessions pagination">
                        <ul class="pagination justify-content-center" id="sessionsPagination">
                        </ul>
                    </nav>
                </div>
            </div>
        </div>

        <!-- Reports Section -->
        <div id="reports-section" class="content-section">
            <div class="row mb-4">
                <div class="col-12">
                    <h2 class="page-title">
                        <i class="fas fa-chart-bar me-2"></i>
                        التقارير والإحصائيات
                    </h2>
                </div>
            </div>

            <div class="row mb-4">
                <div class="col-lg-3 mb-3">
                    <div class="card report-card" data-report="attendance">
                        <div class="card-body text-center">
                            <i class="fas fa-user-check fa-3x text-primary mb-3"></i>
                            <h5>تقرير الحضور</h5>
                            <p class="text-muted">تقرير شامل لحضور الطلاب</p>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-3 mb-3">
                    <div class="card report-card" data-report="absence">
                        <div class="card-body text-center">
                            <i class="fas fa-user-times fa-3x text-danger mb-3"></i>
                            <h5>تقرير الغياب</h5>
                            <p class="text-muted">الطلاب كثيري الغياب</p>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-3 mb-3">
                    <div class="card report-card" data-report="performance">
                        <div class="card-body text-center">
                            <i class="fas fa-chart-line fa-3x text-success mb-3"></i>
                            <h5>تقرير الأداء</h5>
                            <p class="text-muted">أداء الطلاب والدرجات</p>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-3 mb-3">
                    <div class="card report-card" data-report="summary">
                        <div class="card-body text-center">
                            <i class="fas fa-file-alt fa-3x text-info mb-3"></i>
                            <h5>التقرير الشامل</h5>
                            <p class="text-muted">ملخص عام للنظام</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-filter me-2"></i>
                        فلاتر التقرير
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-lg-3 mb-3">
                            <label class="form-label">نوع التقرير</label>
                            <select id="reportType" class="form-select">
                                <option value="attendance">تقرير الحضور</option>
                                <option value="absence">تقرير الغياب</option>
                                <option value="performance">تقرير الأداء</option>
                                <option value="summary">التقرير الشامل</option>
                            </select>
                        </div>
                        
                        <div class="col-lg-2 mb-3">
                            <label class="form-label">من تاريخ</label>
                            <input type="date" id="reportDateFrom" class="form-control">
                        </div>
                        
                        <div class="col-lg-2 mb-3">
                            <label class="form-label">إلى تاريخ</label>
                            <input type="date" id="reportDateTo" class="form-control">
                        </div>
                        
                        <div class="col-lg-2 mb-3">
                            <label class="form-label">الفصل</label>
                            <select id="reportClassFilter" class="form-select">
                                <option value="">جميع الفصول</option>
                            </select>
                        </div>
                        
                        <div class="col-lg-2 mb-3">
                            <label class="form-label">التنسيق</label>
                            <select id="reportFormat" class="form-select">
                                <option value="json">عرض على الشاشة</option>
                                <option value="csv">تحميل CSV</option>
                            </select>
                        </div>
                        
                        <div class="col-lg-1 mb-3">
                            <label class="form-label">&nbsp;</label>
                            <button id="generateReportBtn" class="btn btn-primary w-100">
                                <i class="fas fa-play"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mt-3" id="reportResults" style="display: none;">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-chart-bar me-2"></i>
                        نتائج التقرير
                    </h5>
                </div>
                <div class="card-body">
                    <div id="reportContent">
                        <!-- Report content will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- WhatsApp Section -->
        <div id="whatsapp-section" class="content-section">
            <div class="row mb-4">
                <div class="col-12">
                    <h2 class="page-title">
                        <i class="fab fa-whatsapp me-2"></i>
                        إدارة الواتساب
                    </h2>
                </div>
            </div>

            <div class="row mb-4">
                <div class="col-lg-4 mb-3">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-info-circle me-2"></i>
                                حالة الخدمة
                            </h5>
                        </div>
                        <div class="card-body">
                            <div id="whatsappStatus" class="status-indicator">
                                <div class="status-dot bg-secondary"></div>
                                <span>غير متصل</span>
                            </div>
                            
                            <div class="mt-3">
                                <button id="connectWhatsAppBtn" class="btn btn-success w-100">
                                    <i class="fas fa-plug me-2"></i>
                                    الاتصال بالواتساب
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-8 mb-3">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-paper-plane me-2"></i>
                                إرسال رسالة جماعية
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-lg-6 mb-3">
                                    <label class="form-label">الفصل المستهدف</label>
                                    <select id="whatsappTargetClass" class="form-select">
                                        <option value="">اختر الفصل</option>
                                    </select>
                                </div>
                                
                                <div class="col-lg-6 mb-3">
                                    <label class="form-label">نوع الرسالة</label>
                                    <select id="whatsappMessageType" class="form-select">
                                        <option value="custom">رسالة مخصصة</option>
                                        <option value="attendance_reminder">تذكير بالحضور</option>
                                        <option value="session_announcement">إعلان جلسة</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">نص الرسالة</label>
                                <textarea id="whatsappMessage" class="form-control" rows="4" 
                                          placeholder="اكتب رسالتك هنا..."></textarea>
                            </div>
                            
                            <button id="sendBulkMessageBtn" class="btn btn-primary">
                                <i class="fas fa-paper-plane me-2"></i>
                                إرسال الرسالة
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-history me-2"></i>
                        سجل الرسائل
                    </h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover" id="whatsappLogsTable">
                            <thead>
                                <tr>
                                    <th>الوقت</th>
                                    <th>المستقبل</th>
                                    <th>الرسالة</th>
                                    <th>الحالة</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="4" class="text-center">
                                        <i class="fas fa-spinner fa-spin"></i>
                                        جاري التحميل...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Add Student Modal -->
    <div class="modal fade" id="addStudentModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">إضافة طالب جديد</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addStudentForm">
                        <div class="mb-3">
                            <label class="form-label">اسم الطالب *</label>
                            <input type="text" class="form-control" name="name" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">الباركود *</label>
                            <input type="text" class="form-control" name="barcode" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">الفصل *</label>
                            <select class="form-select" name="class_id" required>
                                <option value="">اختر الفصل</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">رقم ولي الأمر</label>
                            <input type="tel" class="form-control" name="parent_phone">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">المستوى الدراسي</label>
                            <input type="text" class="form-control" name="grade_level">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="submit" form="addStudentForm" class="btn btn-primary">إضافة الطالب</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Class Modal -->
    <div class="modal fade" id="addClassModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">إضافة فصل جديد</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addClassForm">
                        <div class="mb-3">
                            <label class="form-label">اسم الفصل *</label>
                            <input type="text" class="form-control" name="name" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">الوصف</label>
                            <textarea class="form-control" name="description" rows="3"></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">المستوى الدراسي *</label>
                            <input type="text" class="form-control" name="grade_level" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">السعة القصوى *</label>
                            <input type="number" class="form-control" name="capacity" min="1" max="100" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">اسم المدرس</label>
                            <input type="text" class="form-control" name="teacher_name">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="submit" form="addClassForm" class="btn btn-primary">إضافة الفصل</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Session Modal -->
    <div class="modal fade" id="addSessionModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">إنشاء جلسة جديدة</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addSessionForm">
                        <div class="mb-3">
                            <label class="form-label">الفصل *</label>
                            <select class="form-select" name="class_id" required>
                                <option value="">اختر الفصل</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">المادة *</label>
                            <input type="text" class="form-control" name="subject" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">الوصف</label>
                            <textarea class="form-control" name="description" rows="3"></textarea>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">التاريخ *</label>
                                <input type="date" class="form-control" name="date" required>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label">وقت البداية *</label>
                                <input type="time" class="form-control" name="start_time" required>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">وقت النهاية</label>
                                <input type="time" class="form-control" name="end_time">
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label">درجة الكويز الكاملة</label>
                                <input type="number" class="form-control" name="quiz_total_score" min="1" max="100" value="10">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="submit" form="addSessionForm" class="btn btn-primary">إنشاء الجلسة</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Registration Modal -->
    <div class="modal fade" id="quickRegisterModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">تسجيل سريع للطالب</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        الباركود غير موجود في النظام. يمكنك تسجيل الطالب بسرعة.
                    </div>
                    
                    <form id="quickRegisterForm">
                        <input type="hidden" name="barcode" id="quickRegisterBarcode">
                        <input type="hidden" name="session_id" id="quickRegisterSessionId">
                        
                        <div class="mb-3">
                            <label class="form-label">اسم الطالب *</label>
                            <input type="text" class="form-control" name="name" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">رقم ولي الأمر</label>
                            <input type="tel" class="form-control" name="parent_phone">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">المستوى الدراسي</label>
                            <input type="text" class="form-control" name="grade_level">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="submit" form="quickRegisterForm" class="btn btn-success">تسجيل وحضور</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loading-content">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">جاري التحميل...</span>
            </div>
            <p class="mt-2">جاري التحميل...</p>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script src="assets/js/dashboard.js"></script>
</body>
</html>

